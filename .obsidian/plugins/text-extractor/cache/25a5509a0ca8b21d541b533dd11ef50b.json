{"path":"To Be Organized/30 Rock Global Infrastructure/ACI/Jody's Trainings/ACI Node Registration.pdf","text":"ACI Node Registration To register a node within the ACI Fabric, first you must log into a 7sProd machine. First, Open Putty and SSH into 100.113.16.253, port 22. Login as: root Password: default Then type pmshell and hit enter. Here you will see a list of the leafs and which port they are on. Find your port, and take note of the Rack (SW-XXXX) and lf#. Next, type in the port # you want to register and hit enter twice. Login with admin (this will later be changed to SSO log in) Type – show version and hit enter You will get a bunch of information. Take note of the Processor Board ID, specifically the last 4 numbers. This will be the serial you use to find the leaf. Now you will log into the APIC Controller. There are 5 controllers, on IPs 100.113.18.11-15. You can log into the controller with you SSO. Leave the domain blank. Now to register: 1. Go to Fabric, and click fabric membership under the inventory tab. This will open a page to the right. In the upper right corner click nodes pending registration. 2. Here, use the last 4 digits of the board ID you found earlier. You will notice that there is no Node ID associated. 3. Right click on your serial number, and click register. 4. In this new pop up window, leave the Pod ID as 1, and set your Node ID. The Node ID is the lf# with a 2 in front. For example, if your lf is lf55, your node ID will be 255. 5. Next you will set the node name. The node name will be 30r-prdmnc-lf#-bc. The number will be the original lf# you found in putty. Not the 2XX. Next, you will need to set the IP for the node. 1. Go to Tenants, and double click on mgmt. 2. Click on the subfolder Node Management Addresses, and then click on Static Node Management Addresses. 3. On the page that opens, in the upper right corner there is a button that looks like a hammer and wrench. Click that and hit Create Static Node Management Addresses. 4. In the pop up that opens, in the node range type in your node ID. If you are updating a single node, in the from and to type the same node ID, for example, 255 and 255. 5. In the Config, click on Out-Of-Band Addresses. 6. Out of Band Management EPG should be set to default. 7. Set the Out of Band IPV4 Address. The IP address is one to one system based on previous IPs. So if you are setting Node ID 255, you can look at the IP set for Node 254, and add 1 to the final digit. In our example, Node 254 is 100.113.18.94/24. So our IP for Node 255 will be 100.113.18.95/24. You must add the /24 after the IP. Se the gateway to 100.113.18.1. Then click Submit. Now you have both registered and set the Out of Band IP for your node. Next step will be upgrading the Node. 1. Click on the Admin tab. In the blue tab area click on Firmware. In the right corner click Infrastructure. Underneath Infrastructure click Nodes. 2. Now, click the action button (hammer + wrench) and select Schedule Node Upgrade. 3. In Upgrade group name, select odd or even based on your Node ID. Target Firmware Version should be n9000-14.0(2c) You can upgrade now or at a later time. Find and select your Node ID and click submit. It may take some time for the upgrade to complete. Finally, you can add the rack number to the Node information. 1. Click on the Fabric tab. In the blue tab area click on Fabric Policies. Click on the Policies Dropdown arrow. Click on the Geolocation drop down arrow. Site New York Drop Down. Building 30 Rock Drop down. Floor 7th floor drop down. In our case Room 7N-ER drop down. Then click on the drop down for the section of racks your rack is in. Remember, you got the rack information from Putty in the first step. It will be something like SW-061A, indicating it is in Rack 61. This time click on the actual title instead of the drop down. 2. In the page that opens, in the row that says racks there is a + sign on the right corner. Click this plus sign to add a node. Simply type the Node ID, eg, 255, and you can scroll down and see a check box next to the number 255. Click update. You are now done. Troubleshooting: If the Node fails to update, you may need to reboot the node. To do this, follow the initial steps in Putty and log into the port with the node in question. Once you have connected to the node, type “show version” again to verify it has not updated. At this point, you can type the command setup-clean-config.sh This will show you in progress and then a message saying done. Then type the command “reload” The console will ask for verification, type Y, and wait for it to reboot. This may take several minutes. It is finished when you see User Access verification and you see that gzip and cksum and hal x2 have run. The icon will be a hollowed out green cursor. Hit enter to exit that and it will tell you to log in again. Try resending the firmware upgrade now. If the node does upgrade properly, but still doesn’t show up in the fabric, you can try these steps. 1. Run the command acidiag fnread | grep 56 with the 56 being your leaf number on the APIC via putty. 2. On the leaf run the command acidiag fnread. 3. If the apic shows an active connection and the leaf does not there may be a communication issue. You can then run acidiag touch clean on the LEAF ONLY. This does the same thing as the setup-clean-config.sh. If that also doesn’t work, you may need to decommission and rebuild the node. 1. Get the out of band address for the node in question before you decommission. You can decommission in fabric, inventory, fabric membership. Right click on your node and click decommission. Then remove the node from controller (right click and remove). When this finishes, you will no longer see the node in the fabric membership. This will take about 10 minutes. 2. Then run acidiag touch clean 3. At this point it may be a good idea to unplug the leaf from the spine to make sure that no one else accidentally sends a config to the leaf while you are updating. 4. Show lldp nei this will verify that you are not connected to the spine if you get a response with no neighbors 5. acidiag reload 6. acidiag reboot this may give a 404 error 7. reload 8. When you hit enter after the reload has finished (hollow green cursor after access verification), it should prompt you to log in, and where previously we had the host name now we should have (none). If you still see the hostname something went wrong and the leaf was not properly wiped. You may need to go back and check your steps or try it again. Once you log into the leaf it should still show (none). 9. Go back to the APIC and check in inventory fabric membership, At this point go back and reconnect the switch to the spine. 10. Go to the beginning of this guide and re-register the leaf. https://100.113.37.20:8456/acigui is the ACI portal page. You can view a nodes location and information here. https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/4-x/basic- configuration/Cisco-APIC-Basic-Configuration-Guide-401.html","libVersion":"0.3.1","langs":""}