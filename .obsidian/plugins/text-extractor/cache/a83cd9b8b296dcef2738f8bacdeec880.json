{"path":"PDF Library/Firmware Repository/ACI OS Upgrade/Cisco NX-OS to ACI instructions.pdf","text":"This is a guide on how to upgrade a Cisco Switch from NXOS to ACI. You will need; TeraTerm TFTPD (32 or 64 both will work) Serial to Ethernet cable USB to Serial or serial port on laptop Drivers for said serial cable ACI firmware Ethernet cable Flashdrive (only for method 1) There are 2 methods to upgrade the switch. The main difference between the two lies in how you transfer the upgrade file to the switch and if you need an admin password or not. Method 1 uses a USB to transfer the file which is faster, but this will not work if the admin password is not known. There are steps you can take to reset the admin password but at that point you’re better off moving to method 2 which while lengthy has a much higher success rate. Method 1 1. Copy the firmware file to an empty flashdrive. Plug drive into switch. 2. Open teraterm. Select Serial. Make sure you select the right com port, it may be USB serial depending on what cable you are using. 3. You do not need to alter any settings within teraterm a. 9600 Baudrate; 8 Bit data, no parity, 1 bit stop bits, no flow control 4. Hit enter within teraterm to be prompted by a log in screen. The default log in should be admin with no password. We have been encountering more new switches with an unknown password. If the default password does not work for you, you will need to either try resetting the password or switching to method 2. If you are in a time crunch, go with method 2 as it will be more consistent. Password reset procedure at end. 5. Run the following commands: a. Config t b. copy usb1:aci-n9000-dk9.14.0.2c.bin bootflash:aci-n9000-dk9.14.0.2c.bin c. no boot nxos d. copy running-config startup-config e. boot aci bootflash:aci-n9000-dk9.14.0.2c.bin f. show file bootflash:aci-n9000-dk9.14.0.2c.bin md5sum g. reload 6. This should now take about 15 minutes and then you can log in using the default admin no password account. Method 2 On your laptop, set the IP for your nic port to 192.168.X.X. You can set it to whatever you want, just remember it. If at any point you forget your IP, you can look it up via ipconfig. The subnet will be 255.255.255.0. Gateway 192.168.1.1 or whatever range you used. On the front of the switch in the left side you will see 2 ethernet ports on top of each other. Plug the eth to serial cable into the top port, specified by a small terminal logo. Plug in the normal ethernet cable into the bottom port for best results. Open port to the right should work but I have had issues in the past. Connect other ends of those cables to your laptop. You should now have 2 connections to the switch, a serial connection and a network connection. Now open up TFTPD. 1. Go to settings, and go to Global a. Deselect all options EXCEPT for TFTP Server. 2. Go to TFTP tab next to global a. Hit none for security b. Select Bind TFTP to: i. In the drop down menu select your LAPTOPS address that you set earlier. Hit Okay to save all the settings. c. Leave the other settings as is. 3. Now, back in the main interface, by current directory where it says browse, browse to the folder where you saved the aci upgrade file. It should be about 1.3-1.5 gb, and will start with aci and end in .bin. You can hit show directory to verify that your files are there. 4. Now, click on log viewer. Most likely you will see the server interface revert to a 127. IP. It is very important that you click this and set it back to the 192. Of your laptop. If you have a timeout error it is likely because this IP was changed. 5. You are now done configuring TFTPD. Leave the window open and now open teraterm. Do not minimize TFTPD. Leave it open as it may revert IP again. TeraTerm 1. Open teraterm. Select Serial. Make sure you select the right com port, it may be USB serial depending on what cable you are using. 2. You do not need to alter any settings within teraterm a. 9600 Baudrate; 8 Bit data, no parity, 1 bit stop bits, no flow control 3. When you first connect to a switch console port you may have to type either “skip” or “yes” to disable the POAP services. Then after you log in (default is username admin, no password) you type “reload” then “y” and then while it is reloading you type “CTRL+C” repeatedly until you see the “Loader” menu. Reloading is just rebooting the switch. a. If you encounter issues accessing the loader due to lack of admin password, power the unit off by unplugging power but leave your serial connection intact. Power the switch on and wait for the terminal window to start spitting data again. This takes around 30 seconds to start. Once you see the switch booting in the terminal window, start hitting CTRL + C. This should interrupt the OS boot sequence and load into the loader without the need for any password. This may take a few attempts. 4. Hit enter, and you should see a. Loader > i. If you get asked for an admin log in, reboot the switch. It should boot to the loader menu (only if step 3A didn’t apply to you). 5. You will first need to set the switches management IP. This can be anything in the same range as the IP you set for your laptop. Do not use the same IP as your laptop. a. set ip 192.168.x.x 255.255.255.0 6. Hit enter and the IP should be accepted. 7. Next you will upload the firmware. Enter the following command a. Boot tftp://yourlaptopip/firmwareimagename.bin i. Use your laptops IP , 192.168.x.x, whatever you set it to. ii. Make sure the name for the firmware is exact, and includes the .bin. 8. Now the transfer will start. This will take approximately 20 minutes. a. If it finishes too fast and you see a timeout error in the log viewer for tftpd, verify your server interface is set right. Refer to troubleshooting. 9. When it’s done, teraterm will show you that the transfer is successful. You will now need to wait a few more minutes until scrolling texts stop. You will know you are done when you can hit enter and it gives you the option for another command. 10. You can now verify it on the APIC to make sure that it has come up, and in the terminal you run show version to verify it is now running in ACI mode. Troubleshooting If you keep getting a timeout error even though you know you are using the correct interface IP; After the timeout error do not restart the switch. It will run through a series of checks, just wait for it to finish. This may take 10-15 minutes. Once these checks are complete it will attempt to send the file again. It will resume and go much slower this time. This transfer may take between 30 min – 1 hour depending on your laptop. Make sure you reset the IP in the interface for log viewer to the 192 address of your laptop. This time it should go through properly. Most important is to just wait. It may seem like nothing is happening but if you wait at least 15 minutes it will start sending the file again. Password reset If you want to try to reset the password, connect via teraterm as described before. <> indicate insert info here, do not include them when inputting commands. 1. Power cycle the device. 2. Press Ctrl-] (right square bracket) from the console port session when the device begins the Cisco NX-OS software boot sequence to enter the switch(boot)# prompt mode. You need to press Ctrl-] (right square bracket) when you see that the system image is getting loaded. 3. If you were successful you should see a. switch(boot)# 4. Type the following commands: a. switch(boot)# configure terminal b. switch(boot-config)# admin-password <new password> c. WARNING! Remote Authentication for login through console has been d. disabled e. switch(boot-config)# exit 5. Then to reload the switch a. switch(boot)# dir bootflash: b. switch(boot) # load bootflash:<FIRMWARENAME.BIN> 6. Then you can log in with the new password.","libVersion":"0.3.1","langs":""}